---
sidebar: sidebar
permalink: ai/oai_bpod_architecture.html
keywords: NetApp AI, AI, Artificial Intelligence, ML, Machine Learning, NVIDIA, NVIDIA AI Enterprise, NVIDIA BasePOD, NVIDIA DGX
summary: ONTAP AI with NVIDIA DGX BasePOD - Architecture
---

= ONTAP AI with NVIDIA DGX BasePOD - Architecture
:hardbreaks:
:nofooter:
:icons: font
:linkattrs:
:imagesdir: ./../media/

This reference architecture leverages separate fabrics for compute-cluster interconnect and storage access. The compute-cluster network uses a pair of SN3700V Ethernet switches operating as independent redundant fabrics. Each DGX A100 system is connected to the switches using eight single-ported ConnectX-6 cards at 200 Gbps, with even-numbered ports connected to one switch and odd-numbered ports connected to the other switch. The compute fabric switches are configured for RoCE to enable the lowest possible latency for GPU-to-GPU communications. Two additional SN3700V switches are used to provide NFS storage connectivity as well as in-band management and client access to the DGX A100 systems. These SN3700V switches are configured for Multi-chassis Link Aggregation (MLAG) to allow aggregation of bandwidth and transparent failover in the event of a switch failure. Two dual-ported ConnectX-6 cards configured for Ethernet are used to provide two ports from each DGX A100 system to each SN3700V switch. One port from each card is configured into a bond dedicated to storage access, and the other port on each card is configured into a bond for in-band management and client access. Each AFF A800 storage system is connected using four100 GbE  ports from each controller, with a two-port LACP bond to each switch to provide balanced workload distribution across the storage controllers. The drawing below shows the overall solution topology.

The Ethernet network is configured with multiple VLANs to isolate specific traffic types. NFS storage traffic, in-band management, and client access each have dedicated VLANs to provide the proper maximum transmission unit (MTU) and other settings for each traffic type. For example, NFS storage traffic requires an MTU of 9000, while other typical Ethernet traffic uses an MTU of 1500. Figure 5 shows the VLAN connectivity for the hosts and storage system controllers. Note that the AFF A800 storage system controllers have separate 1GbE management interfaces that are plugged into a separate management switch.

To support the storage network requirements of any potential workload on this architecture, each storage controller is provisioned with four 100GbE ports in addition to the onboard ports that are required for storage cluster interconnection. Figure 6 shows the storage system configuration. Each controller is configured with a two-port LACP interface group (ifgrp in Figure 6) to each switch. These interface groups provide up to 200Gbps of resilient connectivity to each switch for data access. Two VLANs are provisioned for NFS storage access, and both storage VLANs are trunked from the switches to each of these interface groups. This configuration allows concurrent access from each host to the data through multiple interfaces, which improves the potential bandwidth that is available to each host.

All data access from the storage system is provided through NFS access from a storage virtual machine (SVM) that is dedicated to this workload. The SVM is configured with a total of four logical interfaces (LIFs), with two LIFs on each storage VLAN. Each interface group hosts a single LIF, resulting in one LIF per VLAN on each controller with a dedicated interface group for each VLAN. However, both VLANs are trunked to both interface groups on each controller. This configuration provides the means for each LIF to fail over to another interface group on the same controller, so that both controllers stay active in the event of a network failure. 

For logical storage provisioning, the solution uses a FlexGroup volume to provide a single pool of storage that is distributed across the nodes in the storage cluster. Each controller hosts an aggregate of 46 disk partitions, with both controllers sharing every disk. When the FlexGroup is deployed on the data SVM, eight FlexVol volumes are provisioned on each aggregate and are then combined into the FlexGroup. This approach allows the storage system to provide a single pool of storage that can scale up to the maximum capacity of the array and provide exceptional performance by leveraging all the SSDs in the array concurrently. NFS clients can access the FlexGroup as a single mount point through any of the LIFs that are provisioned for the SVM. Capacity and client access bandwidth can be increased simply by adding more nodes to the storage cluster. Note that multiple IP addresses are not required to achieve full performance of either the controllers or FlexGroup volume, but they do allow for better hashing and load distribution in the network.

Host configuration
For network connectivity, each DGX A100 system is provisioned with eight ConnectX-6 single-port network interface cards for compute cluster connectivity and two ConnectX-6 dual-port cards for storage and client access connectivity. These cards support up to 200Gb link speeds for both InfiniBand and Ethernet. In this reference architecture, the eight single-port cards are configured for 200Gb RoCE and connected to a pair of SN3700V switches for compute cluster connectivity. The ports on the dual-ported card are connected to another pair of SN3700V switches for storage and client networking. Figure 7 shows the network port and VLAN configuration of the DGX A100 systems.

For Ethernet storage networking, two physical ports are configured as an LACP port-channel on the host side and an MLAG on the switch side. Two additional ports are configured as another LACP bond for in-band management and client access traffic. Due to the high-performance capabilities of the AFF A800 storage system, host-side NFS filesystem caching was disabled for this testing.
image:oai_basepod1_topo.png[Error: Missing Graphic Image]

link:oai_bpod_sizing.html[Next: Sizing Guidance.]